(function(j){var u;var i;var c;var g={};var v;var s;var h;var D={};var p={};var B;var q={};var n=[];var x;var A;var d;var k=0;var C=function(H,O,M,I){var Q=google.maps;var J;J=new Q.Map(H,j.extend({streetViewControl:u.streetViewControl,mapTypeControl:u.mapTypeControl,mapTypeId:Q.MapTypeId.ROADMAP,backgroundColor:u.backgroundColor,center:new Q.LatLng(I.centerLat,I.centerLng)},I));Q.event.addListener(J,"click",O);if(M){Q.event.addListener(J,"mousemove",M)}var N=function(U,W,V,X,S){var T=new Q.Polygon({paths:U,strokeColor:W.color,strokeOpacity:W.opacity,strokeWeight:W.width,fillColor:V.color,fillOpacity:V.opacity});T.setMap(J);Q.event.addListener(T,"click",X);if(S){Q.event.addListener(T,"mousemove",S)}return T};var P=function(T,S){return new Q.LatLng(T,S)};var R=function(){if(J.lastInfoWindow){J.lastInfoWindow.close()}};var L=function(S){S.setMap(null)};var K=function(V,S,U){var T=new Q.InfoWindow({content:'<div id="timezone_picker_infowindow" class="timezone-picker-infowindow">'+S+"</div>"});Q.event.addListener(T,"domready",function(){j("#timezone_picker_infowindow").parent().parent().parent().prev().css("border-radius","5px");if(U){U.apply(j("#timezone_picker_infowindow"))}});T.setPosition(V);T.open(J);J.lastInfoWindow=T};return{addPolygon:N,createPoint:P,hideInfoWindow:R,removePolygon:L,showInfoWindow:K}};var b=function(I,S,L,V){var Y;var W=new OpenLayers.Map(OpenLayers.Util.extend({div:I,projection:"EPSG:900913",displayProjection:"EPSG:4326",numZoomLevels:18,controls:[new OpenLayers.Control.Attribution(),new OpenLayers.Control.DragPan(),new OpenLayers.Control.Navigation({mouseWheelOptions:{cumulative:false,maxDelta:6,interval:50},zoomWheelEnabled:true}),new OpenLayers.Control.Zoom(),new OpenLayers.Control.ZoomBox()]},V));var P=new OpenLayers.Layer.WMS("OpenLayers WMS","http://vmap0.tiles.osgeo.org/wms/vmap0",{layers:"basic"});W.addLayer(P);var O=new OpenLayers.Layer.Vector("vector");W.addLayer(O);OpenLayers.Control.Click=OpenLayers.Class(OpenLayers.Control,{defaultHandlerOptions:{single:true,"double":false,pixelTolerance:0,stopSingle:false,stopDouble:false},initialize:function(){this.handlerOptions=OpenLayers.Util.extend({},this.defaultHandlerOptions);OpenLayers.Control.prototype.initialize.apply(this,arguments);this.handler=new OpenLayers.Handler.Click(this,{click:this.trigger},this.handlerOptions)},trigger:function(aa){var Z=W.getLonLatFromViewPortPx(aa.xy);Z.transform(W.getProjectionObject(),new OpenLayers.Projection("EPSG:4326"));G({latLng:{lat:function(){return Z.lat},lng:function(){return Z.lon}}})}});var R=new OpenLayers.Control.Click();W.addControl(R);R.activate();if(L){W.events.register("mousemove",W,function(aa){var Z=W.getLonLatFromViewPortPx(aa.xy);Z.transform(W.getProjectionObject(),new OpenLayers.Projection("EPSG:4326"));L({latLng:{lat:function(){return Z.lat},lng:function(){return Z.lon}}})})}var J=function(aa){if(aa.clickHandler){var Z=W.getLonLatFromPixel(new OpenLayers.Pixel(K.handlers.feature.evt.layerX,K.handlers.feature.evt.layerY));Z.transform(W.getProjectionObject(),new OpenLayers.Projection("EPSG:4326"));aa.clickHandler({latLng:{lat:function(){return Z.lat},lng:function(){return Z.lon}}})}};var X=function(Z){if(Z.feature.hoverHandler){Z.feature.hoverHandler()}};var U=new OpenLayers.Control.SelectFeature(O,{hover:true,highlightOnly:true,renderIntent:"temporary",eventListeners:{beforefeaturehighlighted:X}});var K=new OpenLayers.Control.SelectFeature(O,{onSelect:J});W.addControl(U);W.addControl(K);U.activate();K.activate();W.setCenter(new OpenLayers.LonLat(0,0),V.zoom);var T=function(ae,af,ag,ad,ac){for(var aa=0;aa<ae.length;aa++){ae[aa].transform(new OpenLayers.Projection("EPSG:4326"),W.getProjectionObject())}var Z={strokeColor:af.color,strokeOpacity:af.opacity,strokeWidth:af.width,fillColor:ag.color,fillOpacity:ag.opacity};var ab=new OpenLayers.Geometry.LinearRing(ae);var ah=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.Polygon(ab),null,Z);O.addFeatures([ah]);ah.clickHandler=ad;ah.hoverHandler=ac;return ah};var H=function(aa,Z){return new OpenLayers.Geometry.Point(Z,aa)};var N=function(){if(Y){W.removePopup(Y);Y.destroy();Y=null}};var Q=function(Z){O.removeFeatures([Z])};var M=function(ab,Z,aa){if(Y){N(Y)}ab=new OpenLayers.LonLat(ab.x,ab.y);ab.transform(new OpenLayers.Projection("EPSG:4326"),W.getProjectionObject());Y=new OpenLayers.Popup.FramedCloud("timezone_picker_infowindow",ab,new OpenLayers.Size(100,100),Z,null,true,null);W.addPopup(Y);if(aa){setTimeout(function(){aa.apply(j("#timezone_picker_infowindow"))},100)}};return{addPolygon:T,createPoint:H,hideInfoWindow:N,removePolygon:Q,showInfoWindow:M}};var w,y,t,m,a;var l=function(){j.each(n,function(H,I){h.removePolygon(I)});n=[]};var F=function(){j.each(D,function(I,H){j.each(H,function(J,K){h.removePolygon(K)})});D={}};var E=function(I,J,H,K){if(D[I]){return}j.get(u.jsonRootUrl+"polygons/"+I+".json",function(M){k--;if(k===0&&x){w()}if(K){K()}M=typeof M==="string"?JSON.parse(M):M;D[I]=[];j.extend(p,M.transitions);var L=y(M.polygons,J,H);if(L.inZone){v=I;j.each(L.allPolygons,function(P,N){var O=h.addPolygon(N.coords,{color:u.strokeColor,opacity:u.strokeOpacity,width:u.strokeWidth},{color:u.fillColor,opacity:u.fillOpcity},function(){t(N.polygon)},l);D[I].push(O)});t(L.selectedPolygon)}}).error(function(){console.warn(arguments)})};var r=function(J){if(J.length===1){return J[0]}var H=u.date.getTime()/1000;var I=null;j.each(J,function(K,L){if(L[0]<H&&J[K+1][0]>H){I=L}});if(!I){I=J[0]}return I};var o=function(){h.hideInfoWindow()};w=function(){x.remove();x=null};y=function(I,L,J){var M=[];var K=false;var H;j.each(I,function(P,U){var N=0;var S=U.points.slice(-2);var T=[];var O=0;for(O=0;O<U.points.length;O+=2){var V=U.points.slice(O,O+2);T.push(h.createPoint(V[0],V[1]));if((S[0]<=L&&V[0]>=L)||(S[0]>L&&V[0]<L)){var Q=(V[1]-S[1])/(V[0]-S[0]);var R=Q*(L-S[0])+S[1];if(R<J){N++}}S=V}M.push({polygon:U,coords:T});var W=(N%2===1);K=K||W;if(W){H=U}});return{allPolygons:M,inZone:K,selectedPolygon:H}};var G=function(K){if(k>0){return}o();var J=K.latLng.lat();var H=K.latLng.lng();var I=[];j.each(c,function(M,L){var N=L.boundingBox;if(J>N.ymin&&J<N.ymax&&H>N.xmin&&H<N.xmax){I.push(a(L.name))}});k=I.length;setTimeout(function(){if(k>0){e()}},500);F();j.each(I,function(M,L){E(L,J,H,function(){j.each(n,function(N,O){h.removePolygon(O)});n=[];B=null})})};var f=function(J){var I=J.latLng.lat();var H=J.latLng.lng();j.each(c,function(M,L){var Q=L.boundingBox;if(I>Q.ymin&&I<Q.ymax&&H>Q.xmin&&H<Q.xmax){var O=q[L.name];if(!O){return}var K=y(O.hoverRegion,I,H);var N=a(L.name);if(K.inZone&&N!==B&&N!==v){l();B=N;j.each(K.allPolygons,function(T,R){var S=h.addPolygon(R.coords,{color:"rgba(56, 70, 78, 1)",opacity:0.3,width:1},{color:"rgba(56, 70, 78, 1)",opacity:0.3},G,null);n.push(S)});if(u.onHover){var P=r(O.transitions);u.onHover(P[1],P[2])}}}})};t=function(L){s=L;var O=r(p[L.name]);var H=L.name;var N=O[1];var I=O[2];if(u.onSelected){u.onSelected(H,N,I)}else{var M=function(P){if(P<10){return"0"+P}return P.toString()};var J=new Date();var K=new Date();K.setTime(K.getTime()+(K.getTimezoneOffset()+N)*60*1000);m("<h2>"+H.split("/").slice(-1)[0].replace("_"," ")+" ("+I+')</h2><div class="metadata"><div>Current Time: '+M(K.getHours())+":"+M(K.getMinutes())+":"+M(K.getSeconds())+"</div><div>Your Time: "+M(J.getHours())+":"+M(J.getMinutes())+":"+M(J.getSeconds())+"</div><div>UTC Offset (in hours): "+(N/60)+"</div></div>")}};m=function(J,K){var I;var H=0;if(s.points.length>H){I=s.centroid;H=s.points.length}o();h.showInfoWindow(h.createPoint(I[1],I[0]),J,K)};var e=function(){x=j('<div style="background: url('+d+');z-index:10000;position: absolute;top:0;left:0;"><img style="position:absolute;top:50%; left:50%;margin-top:-8px;margin-left:-8px" src="'+A+'" /></div>');x.height(i.height()).width(i.width());i.append(x)};a=function(H){return H.toLowerCase().replace(/[^a-z0-9]/g,"-")};var z={init:function(H){i=this;u=H||{};u.initialZoom=u.initialZoom||2;u.initialLat=u.initialLat||0;u.initialLng=u.initialLng||0;u.strokeColor=u.strokeColor||"#ff0000";u.strokeWeight=u.strokeWeight||2;u.strokeOpacity=u.strokeOpacity||0.7;u.fillColor=u.fillColor||"#ffcccc";u.fillOpacity=u.fillOpacity||0.5;u.jsonRootUrl=u.jsonRootUrl||"tz_json/";u.date=u.date||new Date();u.mapOptions=j.extend({zoom:u.initialZoom,centerLat:u.initialLat,centerLng:u.initialLng},u.mapOptions);if(typeof u.hoverRegions==="undefined"){u.hoverRegions=true}if(u.useOpenLayers){h=new b(i.get(0),G,u.hoverRegions?f:null,u.mapOptions)}else{h=new C(i.get(0),G,u.hoverRegions?f:null,u.mapOptions)}var I=u.hoverRegions?2:1;var J=function(){I--;if(I===0){w();if(u.onReady){u.onReady()}}};e();j.get(u.jsonRootUrl+"bounding_boxes.json",function(K){c=typeof K==="string"?JSON.parse(K):K;j.each(c,function(L,M){j.extend(g,M.zoneCentroids)});J()});if(u.hoverRegions){j.get(u.jsonRootUrl+"hover_regions.json",function(L){var K=typeof L==="string"?JSON.parse(L):L;j.each(K,function(N,M){q[M.name]=M});J()})}},setDate:function(H){o();u.date=H},hideInfoWindow:o,showInfoWindow:function(H,I){m(H,I)},selectZone:function(H){var I=g[H];if(I){G({latLng:{lat:function(){return I[1]},lng:function(){return I[0]}}})}}};j.fn.timezonePicker=function(H){if(z[H]){return z[H].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof H==="object"||!H){return z.init.apply(this,arguments)}else{j.error("Method "+H+" does not exist on jQuery.timezonePicker.")}}};A="data:image/gif;base64,R0lGODlhEAAQAPIAAKqqqv///729vejo6P///93d3dPT083NzSH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAAACwAAAAAEAAQAAADMwi63P4wyklrE2MIOggZnAdOmGYJRbExwroUmcG2LmDEwnHQLVsYOd2mBzkYDAdKa+dIAAAh+QQJCgAAACwAAAAAEAAQAAADNAi63P5OjCEgG4QMu7DmikRxQlFUYDEZIGBMRVsaqHwctXXf7WEYB4Ag1xjihkMZsiUkKhIAIfkECQoAAAAsAAAAABAAEAAAAzYIujIjK8pByJDMlFYvBoVjHA70GU7xSUJhmKtwHPAKzLO9HMaoKwJZ7Rf8AYPDDzKpZBqfvwQAIfkECQoAAAAsAAAAABAAEAAAAzMIumIlK8oyhpHsnFZfhYumCYUhDAQxRIdhHBGqRoKw0R8DYlJd8z0fMDgsGo/IpHI5TAAAIfkECQoAAAAsAAAAABAAEAAAAzIIunInK0rnZBTwGPNMgQwmdsNgXGJUlIWEuR5oWUIpz8pAEAMe6TwfwyYsGo/IpFKSAAAh+QQJCgAAACwAAAAAEAAQAAADMwi6IMKQORfjdOe82p4wGccc4CEuQradylesojEMBgsUc2G7sDX3lQGBMLAJibufbSlKAAAh+QQJCgAAACwAAAAAEAAQAAADMgi63P7wCRHZnFVdmgHu2nFwlWCI3WGc3TSWhUFGxTAUkGCbtgENBMJAEJsxgMLWzpEAACH5BAkKAAAALAAAAAAQABAAAAMyCLrc/jDKSatlQtScKdceCAjDII7HcQ4EMTCpyrCuUBjCYRgHVtqlAiB1YhiCnlsRkAAAOwAAAAAAAAAAAA==";d="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAAd0SU1FB9sJDgA6CHKQBUUAAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAAADUlEQVQI12NgYGDwAQAAUQBNbrgEdAAAAABJRU5ErkJggg=="})(jQuery);
